\documentclass[12pt,draftclsnofoot,journal,onecolumn]{IEEEtran}
\usepackage{amsfonts}
\usepackage{amsmath,amssymb}
\usepackage{acronym}  % make an acronym
\usepackage{algorithm,algorithmic}
\usepackage{balance}
\usepackage{bm}
\usepackage{booktabs}
\usepackage{color, soul}
\usepackage{cite}
\usepackage{flushend}
\usepackage{graphicx}
\usepackage{indentfirst}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{subfigure}
\usepackage[amsmath,thmmarks]{ntheorem}
\usepackage{theorem}
% Enable Hyper-references.
\usepackage{hyperref}
\hypersetup{hidelinks, 
colorlinks=true,
allcolors=black,
pdfstartview=Fit,
breaklinks=true}

\newtheorem{theorem}{\bf Theorem}
\newtheorem{proposition}{\bf Proposition}
\newtheorem{lemma}{\bf Lemma}
\newtheorem{definition}{Definition}
\newtheorem{remark}{\bf Remark}

\theoremheaderfont{~~~\it}\theorembodyfont{\upshape}%
\theoremstyle{nonumberplain}
\theoremseparator{}
\theoremsymbol{\rule{1ex}{1ex}}
\newtheorem{proof}{Proof:}
\acrodef{EAR}[EAR]{element activation ratio}
\acrodef{SNR}[SNR]{signal-to-noise ratio}
\acrodef{TC}[TC]{transmission coefficients}
\acrodef{US-RIS}[US-RIS]{user-side RIS}
\acrodef{BSS-RIS}[BSS-RIS]{base-station-side RIS}
\acrodef{DoF}[DoF]{degree of freedom}
\acrodef{FPGA}[FPGA]{field programmable gate array}
\acrodef{RF}[RF]{radio-frequency}
\acrodef{RIS}[RIS]{reconfigurable intelligent surfaces}
\acrodef{UE}[UE]{user equipment}
\acrodef{DL}[DL]{downlink}
\acrodef{TA}[TA]{transmit antenna}
\acrodef{RA}[RA]{receive antenna}
\acrodef{LoS}[LoS]{line-of-sight}
\acrodef{UL-TBF}[UL-TBF]{uplink transmit beamforming}
\acrodef{TPS}[TPS]{transmit phase shifter}
\acrodef{RC}[RC]{receiver combining}
\acrodef{AWGN}[AWGN]{additive white Gaussian noise}
\acrodef{DFT}[DFT]{discrete Fourier transform}

\def \H {^H}
\def \opt {^{\text{opt}}}
\def \v {\bm v}
\def \w {\bm w}
\def \g {\bm g}
\def \f {\bm f}
\def \T {\bm \Theta}
\def \t {\bm \theta}
\def \x {\bm \xi}
\def \Pmax {P_{\text{max}}}
\def \ml {multi-layer }
\def \tb {transmit beamformer }
\def \sl {single-layer }
\def \diag {\text{diag}}
\def \opt {^{\text{opt}}}
\def \exp {\text{exp}}
\def \arg {\text{arg}}
\newcommand{\RNum}[1]{\uppercase\expandafter{\romannumeral #1\relax}}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}   %Use Input in the format of Algorithm
\renewcommand{\algorithmicensure}{\textbf{Output:}}  %UseOutput in the format of Algorithm
\ifCLASSINFOpdf
\else
\fi
\hyphenation{op-tical net-works semi-conduc-tor}
\begin{document}
\title{Sensing RIS}
\author{{Authors
\vspace*{-1em}}
\thanks{Beijing National Research Center for Information Science and Technology (BNRist)}
%\thanks{Corresponding author: Linglong Dai.}
}

\maketitle

\begin{abstract}
xxx
\end{abstract}

\begin{IEEEkeywords}
xxx
\end{IEEEkeywords}
\section{Introduction}
    Sensing RIS \cite{ma2020smartsensing}.
\section{System Model}
\label{System Model}
\subsection{MISO case}
\label{MISO case}

RIS phase-shift matrix:
\begin{equation}
\label{RIS}
\bm \Theta = \diag \left(\bm \theta\right )=\diag \left(\left[\theta_{1},\cdots ,\theta_{N}\right]\right).
\end{equation}

Signal model:
\begin{equation}
\label{Signal model}
y=\bm f^{H}\bm \Theta\bm G\bm ws+z,
\end{equation}
where $\bm f\in \mathbb C ^{N\times 1}$ and $\bm G \in \mathbb C^{N\times M}$ denote the channel spanning from the RIS to the user and the channel spanning from the BS to the RIS, respectively; $\bm w\in \mathbb C^{M\times 1}$ denotes the beamforming vector at the transmitter BS, with $\left\Vert \bm w\right \Vert_{2}^{2}\leq P$; $s$ denotes the transmitted normalized symbol; $z\sim \mathcal{CN}\left(0,\sigma_{z}^{2}\right)$ denotes the \ac{AWGN} introduced at the receiver user.

With fixed positions of the BS and the RIS, the beamforming vector can be fixed as
\begin{equation}
\label{fixed w}
\bm w=\sqrt{P}\bm a\left(\alpha\right),
\end{equation}
where $\alpha$ is ...

The SNR maximization problem for the receiver user can be formulated as
\begin{subequations}
\label{optimization}
\begin{align}
\label{objective}
\max_{\bm \Theta}~~&\text{SNR}=\frac{1}{\sigma_{z}^{2}}
\left\vert
\bm f^{H}\bm \Theta\bm G\bm w \right\vert^{2},\\
\label{constraint}
~~~~~\text{s.t.~~~}&\left\vert\theta_{n}\right\vert=1,~\forall n.
\end{align}
\end{subequations}

The optimal phase-shift for the $n$-th RIS element can be obtained as
\begin{equation}
\label{optimal RIS}
\theta_{n}\opt = \exp\left(-j\arg\left(f_{n}^{*}\bm g_{n}^{T}\bm w\right)\right),~\forall n,
\end{equation}
where $\bm G = \left[\bm g_{1}, \cdots, \bm g_{N}\right]^{T}$.

Interference field at the $n$-th RIS element, with transmitted symbol $s=1$:
\begin{equation}
\label{interference}
E_{n}(t)=\bm g_{n}^{T}\bm w+f_{n}^{*}e^{j\psi (t)}+v(t).
\end{equation}

Define $\alpha = \left\vert\bm g_{n}^{T}\bm w\right\vert$ and $\beta = \left\vert f_{n}^{*}\right \vert$, and define the phase to be measured as $\varphi = \arg\left(f_{n}^{*}\right)-\arg\left(\bm g_{n}^{T}\bm w\right)$.
Then, the power of interference field can be written as
\begin{equation}
\label{Power of Interference}
\begin{aligned}
P(t)&=A \left| E_{n} (t)\right |^{2}+\zeta\\
&=\underbrace{A\left[\alpha^{2}+\beta^{2}+2\alpha\beta\cos\left(\psi(t)+\varphi\right)\right]}_{\text{Sensor detection signal}}\\
&~~~+\underbrace{2A\text{Re}\left\{\left(\alpha+\beta e^{j\left(\psi(t)+\varphi\right)}\right)v'^{*}(t)\right\}+A\left|v'(t)\right|^{2}+\zeta}_{\text{Noise}},\\
\end{aligned}
\end{equation}
where $v'\overset{\text{d}}{=}v\sim\mathcal{CN}\left(0,\sigma_{v}^{2}\right)$.

To estimate the phase $\varphi$, we need enough observations from the sensor detection signal. For simplicity and without loss of generality, let us assume $\psi(t)=\omega t$ and $\omega=\frac{2\pi}{T_{s}}$. Assume furthermore that $L$ observations $P[l]=P(t_{l})$ at time 
\begin{equation}
\label{observation time}
t_{l}=\frac{l}{L}T_{s},~\forall l\in \left\{0,\cdots ,L-1\right\}
\end{equation}
are used for estimation.
\subsubsection{LS method}
Apply $L$-point \ac{DFT} to the observed sensor detection signals $P[1],\cdots ,P[L]$, we have
\begin{equation}
\label{DFT}
p[l']=\sum\nolimits_{l=0}^{L-1}P[l]e^{-j\frac{2\pi}{L}ll'},~\forall l'\in [L].
\end{equation}
Specifically, we have
\begin{equation}
\label{DFT l=1}
p[1]=\sum\nolimits_{l=0}^{L-1}A\left[\alpha^{2}+\beta^{2}+2\alpha\beta\cos\left(\frac{2\pi}{L}l+\varphi\right)\right]e^{-j\frac{2\pi}{L}l}=\frac{A}{2}e^{j\varphi}.
\end{equation}
Then, the phase $\varphi$ can be estimated as
\begin{equation}
\label{LS estimate result}
\hat{\varphi}=\arg\left(\frac{2p[1]}{A}\right) = \arg\left(p[1]\right).
\end{equation}

%% zja working below
\subsubsection{ML method}
    Suppose the noise field $v'(t)=v'_R(t) + jv'_I(t)\sim \mathcal{CN}(0, \sigma_v^2)$, and the noise of the power sensor is $\zeta \sim \mathcal{N}(0, \sigma_{\zeta}^2)$. Then the distribution of $s(t) := A\left|E_n(t)\right|^2$ is a noncentral chi-squared distribution with degrees of freedom $k=2$, and mean values $\mu_{n,R}, \mu_{n,I}$ given by
    \begin{equation}
        \begin{aligned}
        \mu_{n,R} & = \alpha + \beta \cos(\psi(t)+\varphi),    \\ 
        \mu_{n,I} & = \beta \sin(\psi(t)+\varphi).   \\
        \end{aligned}
    \end{equation}
    Thus, the output of the power sensor is 
    \begin{equation}
        P(t)  = A\left((v'_{R} + \mu_{n,R})^2 + (v'_{I} + \mu_{n,I})^2 \right)+ \zeta 
    \end{equation}
    By defining the noncentral parameter $\lambda(t)$ as
    \begin{equation}
        \lambda(t)  = A(\mu_{n,R}^2 + \mu_{n,I}^2) = A\left[\alpha^{2}+\beta^{2}+2\alpha\beta\cos\left(\psi(t)+\varphi\right)\right],
    \end{equation}
    then the p.d.f of $s(t) := P(t)-\zeta$ is given by the zeroth-order modified Bessel function
    \begin{equation}
        f_{s(t)}(x) = \frac{1}{A\sigma_{v}^2} \exp\left(-\frac{x+\lambda(t)}{A\sigma_v^2}\right)I_{0}\left(\frac{\sqrt{\lambda(t) x}}{A\sigma_v^2/2}\right), x \geq 0.
        \label{ML single observation}
    \end{equation}
    In the following analysis, we assume that $\sigma_{\xi}^2 = 0$. If we have obtained observations $P[l], \forall l\in [L]$, then the log likelihood function is 
    \begin{equation}
        \mathcal{L}(P[0:L] | \varphi) = \sum_{l=0}^{L-1}\left[-\frac{P[l] + \lambda(t_l)}{A\sigma_v^2} + \log I_0\left(\frac{\sqrt{P[l] \lambda(t_l)}}{A\sigma_v^2/2}\right)\right] - L\log(A\sigma_v^2),
        \label{ML likelihood}
    \end{equation}
    and the derivative of \eqref{ML likelihood} is 
    \begin{equation}
        \frac{\partial \mathcal{L}(P[0:L] | \varphi)}{\partial \varphi} = \frac{2\alpha\beta}{\sigma_v^2}\sum_{l=0}^{L-1}\sin(\psi(t_l)+\varphi) \left[1 - R\left( \frac{\sqrt{P[l]\lambda(t_l)}}{A\sigma_v^2/2} \right) \frac{\sqrt{P[l]}}{\sqrt{\lambda(t_l)}}\right],
    \end{equation}
    where the function $R(z)$ is defined as $R(z) = I_1(z)/I_0(z)$. Since the derivative of the function $R(z)$ satisfies the property
    \begin{equation}
        R'(z)=1-R^2(z)-\frac{1}{z}R(z),
    \end{equation}
    then the second derivative of the likelihood function $\mathcal{L}$ can be expressed as
    \begin{equation}
        \begin{aligned}
        \frac{\partial^2 \mathcal{L}(P[0:L] | \varphi)}{\partial \varphi^2}  = &  \frac{2\alpha\beta}{\sigma_v^2} \sum_{l=0}^{L-1}{\cos(\psi(t_l)+\varphi)}\left[1 - R\left(z_l\right) \frac{\sqrt{P[l]}}{\sqrt{\lambda(t_l)}}\right] + \\
        & \frac{4\alpha^2\beta^2}{\sigma_v^4}\sum_{l=0}^{L-1}{\sin^2(\psi(t_l)+\varphi) \left(1-R^2(z_l) -\frac{2}{z_l}R(z_l)\right)\frac{P[l]}{\lambda(t_l)} },\\
        \end{aligned}
        \label{Second Derivative Likelihood}
    \end{equation}
    where $z_l = \sqrt{P[l]\lambda(t_l)}/(A\sigma_v^2/2)$. Then, we can perform the Newton iteration to obtain $\hat{\varphi}$:
    \begin{equation}
        \hat{\varphi}^{(k+1)} = \hat{\varphi}^{(k)} - \frac{\mathcal{L}'(\hat{\varphi}^{(k)})}{\mathcal{L}''(\hat{\varphi}^{(k)})}
    \end{equation}

\subsubsection{CRLB}
    In fact, taking the expectation of \eqref{Second Derivative Likelihood} yields the CRLB of the estimators for $\hat{\varphi}$.
    \begin{equation}
        \begin{aligned}
            \mathbb{E}\left[R(z_l) \sqrt{P[l]}\right] & = \int_{0}^{+\infty}{\frac{1}{A\sigma_v^2}\exp\left(-\frac{x+\lambda_l}{A\sigma_v^2}\right)I_1\left(\frac{\sqrt{\lambda_l x}}{A\sigma_v^2/2}\right)\sqrt{x}{\rm d}x}\\
            & = \sqrt{\lambda_l},
        \end{aligned}
    \end{equation}
    \begin{equation}
        \mathbb{E}\left[\frac{R(z_l)}{z_l} P[l]\right] = \frac{A\sigma_v^2}{2}
    \end{equation}
    \begin{equation}
        \mathbb{E}\left[P[l]\right] = A\sigma_v^2 + \lambda_l
    \end{equation}
    \begin{equation}
        \mathbb{E}\left[\frac{\partial^2\mathcal{L}}{\partial\varphi^2}\right] = 
    \end{equation}



\appendices


\section*{Acknowledgments}


\footnotesize
\balance 
\bibliographystyle{IEEEtran}
\bibliography{SensingRIS, IEEEabrv}

\end{document}











